<% 
picture_accounts = @event.public_attendees.and(:picture_uid.ne => nil)
picture_accounts_count = picture_accounts.count
no_picture_accounts = @event.public_attendees.and(:picture_uid => nil) + @event.private_attendees
no_picture_accounts_count = no_picture_accounts.count
%>
<% if (@event.organisation && (picture_accounts_count + no_picture_accounts_count) > 0) %>
  <div class="image-wall">
    <% picture_accounts.each { |account| %>
    <%= partial :'accounts/square', locals: { account: account, width: '50px' } %>
    <% };  %>
    <% if no_picture_accounts_count > 0 %>
      <% if picture_accounts_count == 0 %>
        <% if no_picture_accounts_count < 10 %>
          &lt; 10 people
        <% else %>
          <%=no_picture_accounts_count %>+ people
        <% end %>
      <% elsif picture_accounts_count > 0 %>
        <% if no_picture_accounts_count < 10 %>
          + others
        <% else %>
          + <%=no_picture_accounts_count %> people
        <% end %>
      <% end %>
    <% end %>
  </div>
  <% if (current_account && ticket = @event.tickets.complete.find_by(account: current_account)) %>
    <% if @event.tickets.complete.and(account: current_account).all? { |ticket| ticket.show_attendance? } %>
      <a class="pagelet-trigger mb-1" href="/events/<%= @event.id %>/hide_attendance">Hide attendance</a>
    <% else %>
      <% if current_account.picture %>
        <a class="pagelet-trigger mb-1" href="/events/<%= @event.id %>/show_attendance">Show your attendance</a>
      <% else %>
        <a href="/accounts/edit" onclick="alert('Please first upload a profile photo');">Show your attendance</a>
      <% end %>
    <% end %>
  <% end %>
<% end %>
