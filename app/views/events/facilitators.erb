<%
account_ids_freq = EventFacilitation
  .collection
  .aggregate([
    { "$match": { "event_id": { "$in": Event.past.pluck(:id) } } },
    { "$group": { "_id": "$account_id", "count": { "$sum": 1 } } },
    { "$sort": { "count": -1 } }
  ])
  .to_a
  .map { |doc| [doc['_id'], doc['count']] }
account_ids_freq = account_ids_freq.paginate(page: params[:page], per_page: 10)
%>

<% accounts = Account.and(:id.in => account_ids_freq.map { |id, freq| id }) %>
<ul class="search-result-list">
  <% account_ids_freq.each { |id, freq|; account = accounts.find { |a| a.id == id } %>
  <li>
    <%= partial 'accounts/search_result', locals: { account: account, facilitator_info: true } %>
  </li>
  <% } %>
</ul>

<div class="mt-3">
  <%= will_paginate account_ids_freq, renderer: WillPaginate::ViewHelpers::BootstrapRenderer %>
</div>
