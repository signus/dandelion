<%= partial :'local_groups/nav', locals: { local_group: @local_group } %>

<div class="search well">

  <% form_tag '', method: 'get', class: 'searchForm mb-0 mb-lg-3' do %>
    <div class="form-row align-items-end">
      <div class="form-group col-12 col-sm-auto">
        <label>Events between</label>
        <%= text_field_tag :from, class: 'form-control datepicker mx-1', value: @from.to_fs(:db_local) %>
      </div>
      <div class="form-group col-12 col-sm-auto">
        <label>and</label>
        <%= text_field_tag :to, class: 'form-control datepicker mx-1', value: (@to.to_fs(:db_local) if @to) %>
      </div>
      <div class="form-group col-12 col-sm-auto">
        <label>containing the word</label>
        <%= text_field_tag :q, class: 'form-control mx-1', value: params[:q] %>
      </div>
      <% if @local_group.event_tags.count > 0 %>
        <div class="form-group col-12 col-sm-auto">
          <label>tagged</label>
          <%= select_tag :event_tag_id, options: [''] + @local_group.event_tags.order('name asc').map { |event_tag| [event_tag.name, event_tag.id] }, selected: params[:event_tag_id], class: 'form-control' %>
        </div>
      <% end %>
      <div class="form-group col-12 col-sm-auto">
        <label>Coordinator</label>
        <%= select_tag :coordinator_id, options: [''] + Account.and(:id.in => @local_group.events.pluck(:coordinator_id)).order('name asc').map { |account| [account.name, account.id] }, selected: params[:coordinator_id], class: 'form-control mx-1' %>
      </div>
    </div>
    <div class="form-row align-items-end mt-1">
      <%= checkbox 'Online', form_group_class: 'col-12 col-sm-auto' %>
      <%= checkbox 'In person', form_group_class: 'col-12 col-sm-auto' %>
      <%= checkbox 'No coordinator', form_group_class: 'col-12 col-sm-auto' %>
      <%= checkbox 'No facilitators', form_group_class: 'col-12 col-sm-auto' %>
      <div class="form-group col-12 col-sm-auto">
        <%= submit_tag 'Search', class: 'btn btn-primary mb-0' %>
      </div>
    </div>
    <%= hidden_field_tag :search, value: 1 %>
  <% end %>

</div>

<h2 class="my-3">
  <span class="badge badge-primary"><%= pluralize @events.count, 'event' %></span>
</h2>
<script>
  $(function () {
    if ($(window).width() > 992)
      $('#event_stats').stickyTableHeaders({zIndex: 9999})
  })
</script>
<%= partial :'events/event_stats', locals: { events: @events, organisation: @local_group.organisation } %>
